<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Wi-Fi Configuration Utility</title>
<link id="favicon" rel="icon" href="https://upload.wikimedia.org/wikipedia/commons/6/6a/Wi-Fi_icon.svg" />
<style>
  /* === Body & basics === */
  html, body {
    margin: 0; padding: 0; height: 100%;
  }
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    text-align: center;
    padding: 40px;
    background-color: #f2f2f2;
    color: #222;
    transition: background-color 0.4s ease, color 0.4s ease;
    user-select: none;
    overflow-x: hidden;
    opacity: 0; /* hide initially until load done */
    transition: opacity 0.6s ease;
  }
  body.loaded {
    opacity: 1;
  }
  input[type="text"], input[type="url"] {
    padding: 10px 12px;
    font-size: 16px;
    width: 100%;
    box-sizing: border-box;
    margin-bottom: 16px;
    border-radius: 8px;
    border: 1.8px solid #ccc;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
    font-weight: 500;
  }
  input[type="text"]:focus, input[type="url"]:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 8px rgba(0,123,255,0.5);
  }
  button {
    cursor: pointer;
    border: none;
    border-radius: 8px;
    padding: 12px 28px;
    font-size: 16px;
    font-weight: 600;
    background: #007bff;
    color: white;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
    box-shadow: 0 4px 9px rgba(0, 123, 255, 0.3);
    user-select: none;
    margin: 6px 8px 20px;
    min-width: 120px;
    letter-spacing: 0.04em;
  }
  button:hover {
    background: #0056b3;
    box-shadow: 0 6px 15px rgba(0, 86, 179, 0.5);
  }

  h1 {
    font-weight: 700;
    font-size: 2.8rem;
    margin-bottom: 10px;
    user-select: text;
  }
  p {
    font-size: 1.15rem;
    margin-bottom: 30px;
    user-select: text;
    color: #444;
  }
  .section {
    margin-top: 28px;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
    user-select: none;
  }

  /* === Modal styles === */
  #settingsModal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.55);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    opacity: 0;
    transition: opacity 0.35s ease;
  }
  #settingsModal.show {
    display: flex;
    opacity: 1;
  }
  #settingsContent {
    background: #ffffff;
    border-radius: 18px;
    padding: 30px 36px;
    width: 360px;
    max-width: 90vw;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 12px 30px rgba(0,0,0,0.18);
    transform: scale(0.75);
    opacity: 0;
    transition: transform 0.35s ease, opacity 0.35s ease;
    font-weight: 500;
    color: #222;
    user-select: text;
  }
  #settingsModal.show #settingsContent {
    transform: scale(1);
    opacity: 1;
  }
  body.dark-mode #settingsContent {
    background: #2a2a2a;
    color: #eee;
    box-shadow: 0 12px 30px rgba(255,255,255,0.08);
  }

  /* Labels & Inputs */
  #settingsContent h2 {
    font-weight: 700;
    font-size: 1.7rem;
    margin-bottom: 18px;
    user-select: text;
  }
  label {
    display: block;
    text-align: left;
    font-weight: 600;
    margin-bottom: 8px;
    font-size: 0.95rem;
    user-select: text;
  }

  /* Toggle Switch */
  .toggle-switch {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    gap: 14px;
    margin-top: 12px;
    cursor: pointer;
    user-select: none;
  }
  .toggle-switch input[type="checkbox"] {
    width: 48px;
    height: 28px;
    position: relative;
    appearance: none;
    background: #ccc;
    border-radius: 28px;
    outline: none;
    transition: background 0.3s;
    flex-shrink: 0;
    box-shadow: inset 0 0 6px rgba(0,0,0,0.1);
  }
  .toggle-switch input[type="checkbox"]:checked {
    background: #007bff;
  }
  .toggle-switch input[type="checkbox"]::before {
    content: "";
    position: absolute;
    top: 3px;
    left: 3px;
    width: 22px;
    height: 22px;
    background: white;
    border-radius: 22px;
    transition: 0.3s;
    box-shadow: 0 2px 6px rgba(0,0,0,0.12);
  }
  .toggle-switch input[type="checkbox"]:checked::before {
    left: 23px;
  }
  .toggle-switch label {
    font-size: 1rem;
    color: inherit;
    user-select: text;
  }

  /* Close & Apply buttons styling */
  #applySettingsBtn {
    background: #28a745;
    margin-top: 24px;
    width: 100%;
    box-shadow: 0 6px 12px rgba(40, 167, 69, 0.5);
    letter-spacing: 0.05em;
    font-weight: 700;
  }
  #applySettingsBtn:hover {
    background: #1e7e34;
    box-shadow: 0 8px 18px rgba(30, 126, 52, 0.7);
  }
  #closeSettings {
    background: #dc3545;
    margin-top: 12px;
    width: 100%;
    box-shadow: 0 6px 12px rgba(220, 53, 69, 0.5);
    letter-spacing: 0.05em;
    font-weight: 700;
  }
  #closeSettings:hover {
    background: #b02a37;
    box-shadow: 0 8px 18px rgba(176, 42, 55, 0.7);
  }

  /* Settings Button */
  #openSettingsBtn {
    user-select: none;
    background: #343a40;
    padding: 14px 32px;
    font-size: 18px;
    font-weight: 700;
    border-radius: 14px;
    color: #fff;
    box-shadow: 0 6px 12px rgba(52, 58, 64, 0.6);
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
    margin-top: 40px;
    min-width: 180px;
    letter-spacing: 0.05em;
  }
  #openSettingsBtn:hover {
    background: #23272b;
    box-shadow: 0 8px 18px rgba(35, 39, 43, 0.9);
  }

  /* Dark mode body */
  body.dark-mode {
    background-color: #121212;
    color: #eee;
    transition: background-color 0.4s ease, color 0.4s ease;
  }
  body.dark-mode input[type="text"],
  body.dark-mode input[type="url"] {
    background-color: #333;
    color: #eee;
    border: 1.8px solid #555;
  }
  body.dark-mode button {
    background-color: #1e88e5;
    color: #eee;
    box-shadow: 0 4px 9px rgba(30, 136, 229, 0.4);
  }
  body.dark-mode button:hover {
    background-color: #1565c0;
    box-shadow: 0 6px 15px rgba(21, 101, 192, 0.6);
  }

  /* Donation Button Special Style */
  #openDonateBtn {
    background-color: #ffc439;
    color: #111;
    font-weight: 700;
    border-radius: 8px;
    box-shadow: 0 4px 9px rgba(255, 196, 10, 0.7);
    min-width: 200px;
    margin: 6px auto 20px auto;
    display: block;
    cursor: pointer;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
  }
  #openDonateBtn:hover {
    background-color: #e6b132;
    box-shadow: 0 6px 15px rgba(230, 177, 50, 0.9);
  }

  /* Canvas for snow */
  #snowCanvas {
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    pointer-events: none;
    z-index: 9998;
    user-select: none;
  }

  /* Loading Bar Styles */
  #loadingBarContainer {
    position: fixed;
    top: 0; left: 0;
    width: 100%;
    height: 4px;
    background: transparent;
    z-index: 10000;
    user-select: none;
  }
  #loadingBar {
    height: 100%;
    width: 0;
    background: #007bff;
    box-shadow: 0 0 8px #007bff;
    transition: none; /* We'll animate with JS */
  }
</style>
</head>
<body>
  <!-- Loading bar -->
  <div id="loadingBarContainer" aria-hidden="true">
    <div id="loadingBar"></div>
  </div>

  <h1>üì∂ FakeDNS Portal</h1>
  <p>You‚Äôre connected and avoiding censorship, bro. Choose a site or enter your own domain below. If all else fails, smash the üî• fallback button.</p>

  <div class="section">
    <form id="customDomainForm">
      <input type="text" id="customDomainInput" placeholder="Enter a domain or search on DuckDuckGo" autocomplete="off" />
      <br />
      <button type="submit">Open Domain</button>
    </form>
  </div>

  <div class="section">
    <h2>Quick Links (Open in New Tab)</h2>
    <button onclick="window.open('https://www.google.com', '_blank')">Google</button>
    <button onclick="window.open('https://www.youtube.com', '_blank')">YouTube</button>
    <button onclick="window.open('https://duckduckgo.com', '_blank')">DuckDuckGO</button>
    <button onclick="window.open('https://open.spotify.com', '_blank')">Spotify</button>
    <button onclick="window.open('https://chat.openai.com', '_blank')">ChatGPT</button>
    <button onclick="window.open('https://croxyproxy.com', '_blank')">CroxyProxy</button>
    <button onclick="window.open('https://youtubeunblocked.live', '_blank')">YouTube Proxy</button>
  </div>

  <div class="section">
    <h2>üö® Fallback Button</h2>
    <button onclick="window.location.href='https://us.idnsportal.com'">Go to iDNSPortal (if this breaks)</button>
  </div>

  <!-- Donation Button -->
  <div class="section">
    <button id="openDonateBtn">üí∏ Donate with PayPal.me</button>
  </div>

  <!-- Settings Button -->
  <div class="section">
    <button id="openSettingsBtn">‚öôÔ∏è Settings</button>
  </div>

  <!-- Modal -->
  <div id="settingsModal" aria-hidden="true">
    <div id="settingsContent" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
      <h2 id="settingsTitle">Customize Page & Dark Mode</h2>

      <label for="pageTitleInput">Page Title</label>
      <input type="text" id="pageTitleInput" placeholder="Enter new page title" />

      <label for="faviconInput">Favicon URL</label>
      <input type="url" id="faviconInput" placeholder="Enter favicon URL" />

      <label class="toggle-switch" for="darkModeToggle">
        <input type="checkbox" id="darkModeToggle" />
        <span>Enable Dark Mode</span>
      </label>

      <label class="toggle-switch" for="snowToggle">
        <input type="checkbox" id="snowToggle" />
        <span>Enable Snowfall</span>
      </label>

      <label for="panicKeyInput" style="margin-top: 22px; text-align: left; font-weight: 600; display: block; font-size: 0.95rem;">
        Panic Key (single letter or digit)
      </label>
      <input type="text" id="panicKeyInput" maxlength="1" placeholder="Default: P" style="text-transform: uppercase;" />

      <label for="panicUrlInput" style="margin-top: 12px; text-align: left; font-weight: 600; display: block; font-size: 0.95rem;">
        Panic URL
      </label>
      <input type="url" id="panicUrlInput" placeholder="Default: https://portal.austinisd.org" />

      <button id="applySettingsBtn">Apply Changes</button>
      <button id="closeSettings">Close</button>
    </div>
  </div>

  <canvas id="snowCanvas"></canvas>

<script>
  // === Variables & helpers for snow ===
  const canvas = document.getElementById('snowCanvas');
  const ctx = canvas.getContext('2d');
  let width = window.innerWidth;
  let height = window.innerHeight;
  let snowflakes = [];
  let snowAnimationId = null;

  // Resize canvas to full screen
  function resizeCanvas() {
    width = window.innerWidth;
    height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;
  }
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

  // Snowflake class with color depending on dark mode
  class Snowflake {
    constructor() {
      this.reset();
    }
    reset() {
      this.x = Math.random() * width;
      this.y = Math.random() * height;
      this.radius = 1 + Math.random() * 3;
      this.speed = 0.5 + Math.random() * 1.2;
      this.wind = (Math.random() - 0.5) * 0.5;
      this.opacity = 0.3 + Math.random() * 0.7;
    }
    update() {
      this.y += this.speed;
      this.x += this.wind;
      if (this.y > height) {
        this.y = 0;
        this.x = Math.random() * width;
      }
      if (this.x > width) this.x = 0;
      else if (this.x < 0) this.x = width;
    }
    draw() {
      const isDark = document.body.classList.contains("dark-mode");
      const color = isDark
        ? `rgba(255, 255, 255, ${this.opacity})`
        : `rgba(30, 30, 30, ${this.opacity * 0.8})`;
      ctx.beginPath();
      ctx.fillStyle = color;
      ctx.shadowColor = color;
      ctx.shadowBlur = 3;
      ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
      ctx.fill();
    }
  }

  function createSnowflakes(count = 150) {
    snowflakes = [];
    for(let i = 0; i < count; i++) {
      snowflakes.push(new Snowflake());
    }
  }

  function animateSnow() {
    ctx.clearRect(0, 0, width, height);
    snowflakes.forEach(snowflake => {
      snowflake.update();
      snowflake.draw();
    });
    snowAnimationId = requestAnimationFrame(animateSnow);
  }

  function startSnow() {
    if(snowAnimationId) cancelAnimationFrame(snowAnimationId);
    createSnowflakes();
    animateSnow();
  }
  function stopSnow() {
    if(snowAnimationId) {
      cancelAnimationFrame(snowAnimationId);
      snowAnimationId = null;
      ctx.clearRect(0, 0, width, height);
    }
  }

  // === Settings & Dark Mode & Snow Toggle logic ===

  // Elements
  const openSettingsBtn = document.getElementById("openSettingsBtn");
  const settingsModal = document.getElementById("settingsModal");
  const closeSettingsBtn = document.getElementById("closeSettings");
  const applySettingsBtn = document.getElementById("applySettingsBtn");
  const darkModeToggle = document.getElementById("darkModeToggle");
  const snowToggle = document.getElementById("snowToggle");
  const pageTitleInput = document.getElementById("pageTitleInput");
  const faviconInput = document.getElementById("faviconInput");
  const favicon = document.getElementById("favicon");
  const panicKeyInput = document.getElementById("panicKeyInput");
  const panicUrlInput = document.getElementById("panicUrlInput");

  // Open settings modal
  openSettingsBtn.addEventListener("click", () => {
    settingsModal.classList.add("show");
    settingsModal.setAttribute("aria-hidden", "false");
    pageTitleInput.focus();
  });

  // Close settings modal
  closeSettingsBtn.addEventListener("click", () => {
    settingsModal.classList.remove("show");
    settingsModal.setAttribute("aria-hidden", "true");
  });

  // Click outside modal closes it
  settingsModal.addEventListener("click", (e) => {
    if (e.target === settingsModal) {
      settingsModal.classList.remove("show");
      settingsModal.setAttribute("aria-hidden", "true");
    }
  });

  // Apply settings button
  applySettingsBtn.addEventListener("click", () => {
    const newTitle = pageTitleInput.value.trim();
    if (newTitle.length > 0) {
      document.title = newTitle;
      localStorage.setItem("customTitle", newTitle);
    } else {
      localStorage.removeItem("customTitle");
    }

    const newFavicon = faviconInput.value.trim();
    if (newFavicon.length > 0) {
      favicon.href = newFavicon;
      localStorage.setItem("customFavicon", newFavicon);
    } else {
      favicon.href = "https://upload.wikimedia.org/wikipedia/commons/6/6a/Wi-Fi_icon.svg";
      localStorage.removeItem("customFavicon");
    }

    const darkModeEnabled = darkModeToggle.checked;
    if (darkModeEnabled) {
      document.body.classList.add("dark-mode");
      localStorage.setItem("darkMode", "true");
    } else {
      document.body.classList.remove("dark-mode");
      localStorage.setItem("darkMode", "false");
    }

    const snowEnabled = snowToggle.checked;
    localStorage.setItem("snowEnabled", snowEnabled ? "true" : "false");
    if (snowEnabled) startSnow();
    else stopSnow();

    const panicKey = panicKeyInput.value.trim().toUpperCase() || "P";
    localStorage.setItem("panicKey", panicKey);

    const panicUrl = panicUrlInput.value.trim() || "https://portal.austinisd.org";
    localStorage.setItem("panicUrl", panicUrl);

    settingsModal.classList.remove("show");
    settingsModal.setAttribute("aria-hidden", "true");
  });

  // Load settings on page load
  function loadSettings() {
    const darkMode = localStorage.getItem("darkMode") === "true";
    const customTitle = localStorage.getItem("customTitle") || "";
    const customFavicon = localStorage.getItem("customFavicon") || "";
    const panicKey = localStorage.getItem("panicKey") || "P";
    const panicUrl = localStorage.getItem("panicUrl") || "https://portal.austinisd.org";
    const snowEnabled = localStorage.getItem("snowEnabled") === "true";

    if (darkMode) {
      document.body.classList.add("dark-mode");
      darkModeToggle.checked = true;
    } else {
      document.body.classList.remove("dark-mode");
      darkModeToggle.checked = false;
    }

    if (customTitle) {
      document.title = customTitle;
      pageTitleInput.value = customTitle;
    }
    if (customFavicon) {
      favicon.href = customFavicon;
      faviconInput.value = customFavicon;
    } else {
      favicon.href = "https://upload.wikimedia.org/wikipedia/commons/6/6a/Wi-Fi_icon.svg";
    }

    panicKeyInput.value = panicKey.toUpperCase();
    panicUrlInput.value = panicUrl;

    snowToggle.checked = snowEnabled;
    if (snowEnabled) {
      startSnow();
    } else {
      stopSnow();
    }
  }

  // Panic key listener
  document.addEventListener("keydown", (e) => {
    const key = localStorage.getItem("panicKey") || "P";
    const panicUrl = localStorage.getItem("panicUrl") || "https://portal.austinisd.org";
    if (e.key.toUpperCase() === key) {
      window.location.href = panicUrl;
    }
  });

  // Donate button
  document.getElementById("openDonateBtn").addEventListener("click", () => {
    window.open("https://paypal.me/freakbob", "_blank");
  });

  // Custom domain form submission
  document.getElementById("customDomainForm").addEventListener("submit", (e) => {
    e.preventDefault();
    const input = document.getElementById("customDomainInput").value.trim();
    if (!input) return;
    const urlPattern = /^[a-z0-9.-]+\.[a-z]{2,}$/i;
    if (urlPattern.test(input)) {
      const ctrlPressed = e.ctrlKey || e.metaKey;
      if (ctrlPressed) window.open(input.startsWith("http") ? input : `https://${input}`, "_blank");
      else window.location.href = input.startsWith("http") ? input : `https://${input}`;
    } else {
      // DuckDuckGo search fallback
      const query = encodeURIComponent(input);
      const ctrlPressed = e.ctrlKey || e.metaKey;
      const searchUrl = `https://duckduckgo.com/?q=${query}`;
      if (ctrlPressed) window.open(searchUrl, "_blank");
      else window.location.href = searchUrl;
    }
  });

  // === Fake loading bar with OS-based timing ===

  // Detect OS function
  function detectOS() {
    const ua = navigator.userAgent || navigator.vendor || window.opera;

    if (/windows phone/i.test(ua)) return "windows";
    if (/windows/i.test(ua)) return "windows";
    if (/macintosh|mac os x/i.test(ua)) return "macos";
    if (/cros/i.test(ua)) return "chromeos";
    if (/android/i.test(ua)) return "android";
    if (/iphone|ipad|ipod/i.test(ua)) return "ios";
    return "unknown";
  }

  function getRandomInRange(min, max) {
    return Math.random() * (max - min) + min;
  }

  // Loading durations per OS in seconds
  const loadingDurations = {
    macos: [2.6, 3.4],
    windows: [0.7, 1.2],
    chromeos: [1.7, 2.1],
    android: [0.6, 0.8],
    ios: [2.1, 3.4],
    unknown: [1, 2]
  };

  const loadingBar = document.getElementById("loadingBar");
  const loadingContainer = document.getElementById("loadingBarContainer");
  const body = document.body;

  // Animate loading bar with slow then fast effect
  function animateLoadingBar(duration) {
    return new Promise((resolve) => {
      // duration is total time to fill bar in seconds
      const slowPhase = 500; // 0.5 seconds slow growth (in ms)
      const fastPhase = duration * 1000 - slowPhase; // remainder fast growth

      let start = null;

      function step(timestamp) {
        if (!start) start = timestamp;
        const elapsed = timestamp - start;

        let progress;
        if (elapsed < slowPhase) {
          // slow linear progress from 0 to 0.3 (30%)
          progress = (elapsed / slowPhase) * 0.3;
        } else if (elapsed < slowPhase + fastPhase) {
          // fast progress from 0.3 to 1.0
          progress = 0.3 + ((elapsed - slowPhase) / fastPhase) * 0.7;
        } else {
          progress = 1;
        }

        loadingBar.style.width = (progress * 100) + "%";

        if (elapsed < duration * 1000) {
          requestAnimationFrame(step);
        } else {
          resolve();
        }
      }
      requestAnimationFrame(step);
    });
  }

  // On load: run loading then show content
  async function runFakeLoad() {
    const os = detectOS();
    const [minDur, maxDur] = loadingDurations[os] || loadingDurations["unknown"];
    const duration = getRandomInRange(minDur, maxDur);

    // Show loading bar container and hide content by default
    loadingContainer.style.display = "block";
    body.classList.remove("loaded");
    body.style.opacity = "0";

    await animateLoadingBar(duration);

    // Hide loading bar and show content
    loadingContainer.style.display = "none";
    body.classList.add("loaded");
  }

  // Run the fake loader immediately on page load
  runFakeLoad();

  // === Snow starts/stops based on settings loaded ===
  // loadSettings includes snow start/stop and dark mode apply

  // Load settings after fake loading is done to avoid flicker
  window.addEventListener("load", () => {
    loadSettings();
  });
</script>

</body>
</html>
